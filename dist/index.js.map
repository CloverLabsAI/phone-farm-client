{"version":3,"file":"index.js","sources":["../src/errors.ts","../src/client.ts"],"sourcesContent":["export class PhoneFarmError extends Error {\n  public readonly status: number;\n  public readonly detail: string;\n\n  constructor(status: number, detail: string) {\n    super(`PhoneFarm API error ${status}: ${detail}`);\n    this.name = \"PhoneFarmError\";\n    this.status = status;\n    this.detail = detail;\n  }\n}\n\nexport class NoPhonesAvailableError extends PhoneFarmError {\n  constructor(detail = \"No phones available\") {\n    super(409, detail);\n    this.name = \"NoPhonesAvailableError\";\n  }\n}\n\nexport class SlotNotFoundError extends PhoneFarmError {\n  constructor(detail = \"Slot not found\") {\n    super(404, detail);\n    this.name = \"SlotNotFoundError\";\n  }\n}\n\nexport class DeviceBusyError extends PhoneFarmError {\n  constructor(detail = \"Device is busy\") {\n    super(409, detail);\n    this.name = \"DeviceBusyError\";\n  }\n}\n\nexport class DeviceOfflineError extends PhoneFarmError {\n  constructor(detail = \"Device is offline\") {\n    super(409, detail);\n    this.name = \"DeviceOfflineError\";\n  }\n}\n\nexport class TunnelNotAvailableError extends PhoneFarmError {\n  constructor(detail = \"Tunnel not available\") {\n    super(503, detail);\n    this.name = \"TunnelNotAvailableError\";\n  }\n}\n","import type {\n  ClientOptions,\n  CreateSlotOptions,\n  CreateSlotResult,\n  DeleteSlotResult,\n  CreateSessionResult,\n  ReleaseSessionResult,\n} from \"./types\";\nimport {\n  PhoneFarmError,\n  NoPhonesAvailableError,\n  SlotNotFoundError,\n  DeviceBusyError,\n  DeviceOfflineError,\n  TunnelNotAvailableError,\n} from \"./errors\";\n\nexport class PhoneFarmClient {\n  private readonly baseUrl: string;\n  private readonly apiKey: string;\n\n  constructor(options: ClientOptions) {\n    this.baseUrl = options.baseUrl.replace(/\\/+$/, \"\");\n    this.apiKey = options.apiKey;\n  }\n\n  /** Create a persistent slot (auto-assigns a device).\n   *\n   * Returns the slot ID. Use `createSession` to start an active session.\n   */\n  async createSlot(options?: CreateSlotOptions): Promise<string> {\n    const res = await this.request<CreateSlotResult>(\"POST\", \"/api/v1/slots\", options);\n    return res.slot_id;\n  }\n\n  /** Delete a slot and release any active session. */\n  async deleteSlot(slotId: string): Promise<void> {\n    await this.request<DeleteSlotResult>(\"DELETE\", `/api/v1/slots/${slotId}`);\n  }\n\n  /** Start an active session for a slot.\n   *\n   * Locks the device and returns the tunnel URL.\n   */\n  async createSession(slotId: string): Promise<string> {\n    const res = await this.request<CreateSessionResult>(\n      \"POST\",\n      `/api/v1/slots/${slotId}/sessions`\n    );\n    return res.url;\n  }\n\n  /** Release the active session for a slot. */\n  async releaseSession(slotId: string): Promise<ReleaseSessionResult> {\n    return this.request<ReleaseSessionResult>(\n      \"POST\",\n      `/api/v1/slots/${slotId}/sessions/release`\n    );\n  }\n\n  private async request<T>(\n    method: string,\n    path: string,\n    body?: unknown\n  ): Promise<T> {\n    const url = `${this.baseUrl}${path}`;\n\n    const headers: Record<string, string> = {\n      \"X-API-Key\": this.apiKey,\n      \"Content-Type\": \"application/json\",\n    };\n\n    const res = await fetch(url, {\n      method,\n      headers,\n      body: body !== undefined ? JSON.stringify(body) : undefined,\n    });\n\n    if (!res.ok) {\n      const errorBody = await res.json().catch(() => ({ detail: res.statusText }));\n      const detail =\n        typeof errorBody.detail === \"object\"\n          ? errorBody.detail.message\n          : errorBody.detail || res.statusText;\n      const errorCode =\n        typeof errorBody.detail === \"object\" ? errorBody.detail.code : undefined;\n\n      switch (res.status) {\n        case 404:\n          throw new SlotNotFoundError(detail);\n        case 409:\n          if (errorCode === \"DEVICE_BUSY\") throw new DeviceBusyError(detail);\n          if (errorCode === \"DEVICE_OFFLINE\") throw new DeviceOfflineError(detail);\n          throw new NoPhonesAvailableError(detail);\n        case 503:\n          throw new TunnelNotAvailableError(detail);\n        default:\n          throw new PhoneFarmError(res.status, detail);\n      }\n    }\n\n    return res.json() as Promise<T>;\n  }\n}\n"],"names":[],"mappings":"AAAM,MAAO,cAAe,SAAQ,KAAK,CAAA;IAIvC,WAAA,CAAY,MAAc,EAAE,MAAc,EAAA;AACxC,QAAA,KAAK,CAAC,CAAA,oBAAA,EAAuB,MAAM,KAAK,MAAM,CAAA,CAAE,CAAC;AACjD,QAAA,IAAI,CAAC,IAAI,GAAG,gBAAgB;AAC5B,QAAA,IAAI,CAAC,MAAM,GAAG,MAAM;AACpB,QAAA,IAAI,CAAC,MAAM,GAAG,MAAM;IACtB;AACD;AAEK,MAAO,sBAAuB,SAAQ,cAAc,CAAA;IACxD,WAAA,CAAY,MAAM,GAAG,qBAAqB,EAAA;AACxC,QAAA,KAAK,CAAC,GAAG,EAAE,MAAM,CAAC;AAClB,QAAA,IAAI,CAAC,IAAI,GAAG,wBAAwB;IACtC;AACD;AAEK,MAAO,iBAAkB,SAAQ,cAAc,CAAA;IACnD,WAAA,CAAY,MAAM,GAAG,gBAAgB,EAAA;AACnC,QAAA,KAAK,CAAC,GAAG,EAAE,MAAM,CAAC;AAClB,QAAA,IAAI,CAAC,IAAI,GAAG,mBAAmB;IACjC;AACD;AAEK,MAAO,eAAgB,SAAQ,cAAc,CAAA;IACjD,WAAA,CAAY,MAAM,GAAG,gBAAgB,EAAA;AACnC,QAAA,KAAK,CAAC,GAAG,EAAE,MAAM,CAAC;AAClB,QAAA,IAAI,CAAC,IAAI,GAAG,iBAAiB;IAC/B;AACD;AAEK,MAAO,kBAAmB,SAAQ,cAAc,CAAA;IACpD,WAAA,CAAY,MAAM,GAAG,mBAAmB,EAAA;AACtC,QAAA,KAAK,CAAC,GAAG,EAAE,MAAM,CAAC;AAClB,QAAA,IAAI,CAAC,IAAI,GAAG,oBAAoB;IAClC;AACD;AAEK,MAAO,uBAAwB,SAAQ,cAAc,CAAA;IACzD,WAAA,CAAY,MAAM,GAAG,sBAAsB,EAAA;AACzC,QAAA,KAAK,CAAC,GAAG,EAAE,MAAM,CAAC;AAClB,QAAA,IAAI,CAAC,IAAI,GAAG,yBAAyB;IACvC;AACD;;MC5BY,eAAe,CAAA;AAI1B,IAAA,WAAA,CAAY,OAAsB,EAAA;AAChC,QAAA,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC;AAClD,QAAA,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC,MAAM;IAC9B;AAEA;;;AAGG;IACH,MAAM,UAAU,CAAC,OAA2B,EAAA;AAC1C,QAAA,MAAM,GAAG,GAAG,MAAM,IAAI,CAAC,OAAO,CAAmB,MAAM,EAAE,eAAe,EAAE,OAAO,CAAC;QAClF,OAAO,GAAG,CAAC,OAAO;IACpB;;IAGA,MAAM,UAAU,CAAC,MAAc,EAAA;QAC7B,MAAM,IAAI,CAAC,OAAO,CAAmB,QAAQ,EAAE,CAAA,cAAA,EAAiB,MAAM,CAAA,CAAE,CAAC;IAC3E;AAEA;;;AAGG;IACH,MAAM,aAAa,CAAC,MAAc,EAAA;AAChC,QAAA,MAAM,GAAG,GAAG,MAAM,IAAI,CAAC,OAAO,CAC5B,MAAM,EACN,CAAA,cAAA,EAAiB,MAAM,CAAA,SAAA,CAAW,CACnC;QACD,OAAO,GAAG,CAAC,GAAG;IAChB;;IAGA,MAAM,cAAc,CAAC,MAAc,EAAA;QACjC,OAAO,IAAI,CAAC,OAAO,CACjB,MAAM,EACN,CAAA,cAAA,EAAiB,MAAM,CAAA,iBAAA,CAAmB,CAC3C;IACH;AAEQ,IAAA,MAAM,OAAO,CACnB,MAAc,EACd,IAAY,EACZ,IAAc,EAAA;QAEd,MAAM,GAAG,GAAG,CAAA,EAAG,IAAI,CAAC,OAAO,CAAA,EAAG,IAAI,CAAA,CAAE;AAEpC,QAAA,MAAM,OAAO,GAA2B;YACtC,WAAW,EAAE,IAAI,CAAC,MAAM;AACxB,YAAA,cAAc,EAAE,kBAAkB;SACnC;AAED,QAAA,MAAM,GAAG,GAAG,MAAM,KAAK,CAAC,GAAG,EAAE;YAC3B,MAAM;YACN,OAAO;AACP,YAAA,IAAI,EAAE,IAAI,KAAK,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,SAAS;AAC5D,SAAA,CAAC;AAEF,QAAA,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE;YACX,MAAM,SAAS,GAAG,MAAM,GAAG,CAAC,IAAI,EAAE,CAAC,KAAK,CAAC,OAAO,EAAE,MAAM,EAAE,GAAG,CAAC,UAAU,EAAE,CAAC,CAAC;AAC5E,YAAA,MAAM,MAAM,GACV,OAAO,SAAS,CAAC,MAAM,KAAK;AAC1B,kBAAE,SAAS,CAAC,MAAM,CAAC;kBACjB,SAAS,CAAC,MAAM,IAAI,GAAG,CAAC,UAAU;YACxC,MAAM,SAAS,GACb,OAAO,SAAS,CAAC,MAAM,KAAK,QAAQ,GAAG,SAAS,CAAC,MAAM,CAAC,IAAI,GAAG,SAAS;AAE1E,YAAA,QAAQ,GAAG,CAAC,MAAM;AAChB,gBAAA,KAAK,GAAG;AACN,oBAAA,MAAM,IAAI,iBAAiB,CAAC,MAAM,CAAC;AACrC,gBAAA,KAAK,GAAG;oBACN,IAAI,SAAS,KAAK,aAAa;AAAE,wBAAA,MAAM,IAAI,eAAe,CAAC,MAAM,CAAC;oBAClE,IAAI,SAAS,KAAK,gBAAgB;AAAE,wBAAA,MAAM,IAAI,kBAAkB,CAAC,MAAM,CAAC;AACxE,oBAAA,MAAM,IAAI,sBAAsB,CAAC,MAAM,CAAC;AAC1C,gBAAA,KAAK,GAAG;AACN,oBAAA,MAAM,IAAI,uBAAuB,CAAC,MAAM,CAAC;AAC3C,gBAAA;oBACE,MAAM,IAAI,cAAc,CAAC,GAAG,CAAC,MAAM,EAAE,MAAM,CAAC;;QAElD;AAEA,QAAA,OAAO,GAAG,CAAC,IAAI,EAAgB;IACjC;AACD;;;;"}